<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.commute">
    <insert id="gotoWork" parameterType="com.example.demo.domain.ComVO">
        insert into 
        tbl_commute(
        com_no,
        com_d8,
        com_start,
        com_end,
        com_total,
        prj_in_no)values(
        null,
        #{com_d8},
        sysdate,
        null,
        null,
        #{prj_no})
    </insert>
    <update id="offWork" parameterType="com.example.demo.domain.ComVO">
        UPDATE tbl_commute
        SET
        com_end = sysdate,
        COM_TOTAL = trunc(((SYSDATE - COM_START) * 60 * 24))
        WHERE com_d8 = #{com_d8}
       AND PRJ_IN_NO = (SELECT PRJ_IN_NO FROM TBL_PROJECT_IN tpi WHERE EMAIL = #{my_email} AND PRJ_NO = ${prj_no})
    </update>

    <select id="checkWork" resultType="com.example.demo.domain.ComVO">
        SELECT 
                * 
        FROM tbl_commute
        WHERE com_d8 = #{com_d8}
        AND PRJ_IN_NO = (SELECT 
                                PRJ_IN_NO 
                        FROM TBL_PROJECT_IN tpi 
                        WHERE EMAIL = #{my_email}
                        AND PRJ_NO = ${prj_no}
                        )
    </select>

    <select id="weekTime" resultType="com.example.demo.domain.ComVO">
        SELECT NVL(TC.COM_TOTAL,'0') COM_TOTAL
        FROM tbl_commute TC
        RIGHT OUTER JOIN (SELECT to_char(day + LEVEL - 1, 'yyyy-mm-dd') as DAY FROM 
        ( SELECT trunc(TO_DATE('#{com_d8, jdbcType=VARCHAR}','yyyy-mm-dd'),'DAY') as DAY FROM dual )
        CONNECT BY LEVEL
        <![CDATA[ < ]]>
        = 7)DA ON TC.COM_D8 = DA.DAY ORDER BY DA.DAY;
    </select>
</mapper> 