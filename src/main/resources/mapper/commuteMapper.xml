<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.commute">
    <insert id="gotoWork" parameterType="com.example.demo.domain.ComVO">
        insert into 
        tbl_commute(
        com_no,
        com_d8,
        com_start,
        com_end,
        com_total,
        prj_in_no)

        values(
        null,
        #{com_d8},
        sysdate,
        null,
        null,
        #{prj_in_no})
    </insert>
    <update id="offWork" parameterType="com.example.demo.domain.ComVO">
        UPDATE tbl_commute
        SET
        com_end = sysdate
        WHERE com_d8 = #{com_d8}
       AND PRJ_IN_NO = (SELECT PRJ_IN_NO FROM TBL_PROJECT_IN tpi WHERE EMAIL = #{my_email} AND PRJ_NO = ${prj_no})
    </update>

    <select id="checkWork" resultType="com.example.demo.domain.ComVO">
        SELECT 
                * 
        FROM tbl_commute
        WHERE com_d8 = #{com_d8}
        AND PRJ_IN_NO = (SELECT 
                                PRJ_IN_NO 
                        FROM TBL_PROJECT_IN tpi 
                        WHERE EMAIL = #{my_email}
                        AND PRJ_NO = ${prj_no}
                        )
    </select>
    <update id="workTime" parameterType="com.example.demo.domain.ComVO">
         UPDATE tbl_commute
        SET
        com_total = trunc((com_end - com_start)*24*60)
        WHERE com_d8 = #{com_d8}
       AND PRJ_IN_NO = (SELECT PRJ_IN_NO FROM TBL_PROJECT_IN tpi WHERE EMAIL = #{my_email} AND PRJ_NO = ${prj_no})
    </update>
    <select id="weekTime" resultType="integer">
         SELECT 
                com_total 
        FROM tbl_commute
        WHERE com_d8 = #{com_d8}
        AND PRJ_IN_NO = (SELECT 
                                PRJ_IN_NO 
                        FROM TBL_PROJECT_IN tpi 
                        WHERE EMAIL = #{my_email}
                        AND PRJ_NO = ${prj_no}
                        )
    </select>
</mapper> 